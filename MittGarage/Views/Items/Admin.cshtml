@model MittGarage.Models.SearchCtx

<script src="~/Scripts/admin.js"></script>


@using (Html.BeginForm("Admin", "Items"))
{
    <div ng-controller="GarageController">
        @Html.AntiForgeryToken()
        <table>
            <tr class="="searchlabels">
                <td> @Html.LabelFor(model => model.Searchstring) </td>
                <td> @Html.LabelFor(model => model.Typestring) </td>
                <td> @Html.LabelFor(model => model.OnlyToday) </td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td>
                    @Html.EditorFor(model => model.Searchstring)
                    @Html.ValidationMessageFor(model => model.Searchstring)
                </td>
                <td>
                    @Html.DropDownListFor(model => model.SelectedType,
                                          new SelectList(Model.TypesById, "Key", "Value"))

                    @*@Html.EditorFor(model => model.Typestring)
                    @Html.ValidationMessageFor(model => model.Typestring)*@
                </td>
                <td>
                    @Html.CheckBoxFor(model => model.OnlyToday)
                </td>
                <td>
                   <input type="submit" value="Filtrera" />
                </td>
                <td>
                    <input type="submit" id="detailsButton" value="Detaljer >>>"
                           onclick="return showDetails()"/>
                </td>

            </tr>
        </table>

         <hr/>

        <div ngif="vehicles.length > 0">
            <table class="lists">
                <tr>

                    <th>
                        <a href="#" ng-click="orderByField = 'RegNr'">
                            Regnummer
                        </a>
                    </th>
                    <th>
                        <a href="#" ng-click="orderByField = 'Typename'">
                            Fordonstyp
                        </a>
                    </th>
                    <th>
                        <a href="#" ng-click="orderByField =¨'TimeParked'">
                            Tid
                        </a>
                    </th>
                    <th class="details">
                        <a href="#" ng-click="orderByField = 'OwnerName'">
                            Ägare
                        </a>
                    </th>
                    <th class="details">
                        <a href="#" ng-click="orderByField = 'checkInDate'">
                            incheckad
                        </a>
                    </th>
                    <th class="details">
                        <a href="#" ng-click="orderByField = 'Id'">
                            ID
                        </a>
                    </th>
                    <th></th>
                </tr>

                <tr ng-repeat="vehicle in vehicles | orderBy:orderByField">
                    <td> {{vehicle.RegNr}} </td>
                    <td> {{vehicle.Typename}} </td>
                    <td> {{vehicle.TimeParked}} </td>
                    <td class="details"> {{vehicle.OwnerName}} </td>
                    <td class="details"> {{vehicle.checkInDate}} </td>
                    @*FIXME: http://stackoverflow.com/questions/22435212/angular-js-format-date-from-json-object*@
                    <td class="details"> {{vehicle.Id}} </td>
                    <td>
                        <a href="/Items/Delete/{{vehicle.Id}}">Checka ut</a>
                        @*@Html.ActionLink("Checka ut",
                                             "Delete",
                                             new { Id = 5 })*@ <!--FIXME-->
                    </td>
                </tr>


            </table>
            @*<div class="pagedList" data-otf-target="#itemslist">
                @Html.PagedListPager(
                        Model.PagedResults,
                        page => Url.Action("Admin", new { page }),
                        PagedListRenderOptions.MinimalWithItemCountText)
            </div>*@
        </div>
     </div>
}

<script type="text/javascript">
    function showDetails() {

        var els = document.getElementsByClassName('details');
        for (var i = 0; i < els.length; ++i) {
            if (i == 0) {
                button = document.getElementById("detailsButton");
                if (els[i].style.display == 'table-cell')
                    button.value = button.value.replace("<<<", ">>>");
                else
                    button.value = button.value.replace(">>>", "<<<");
            }
            if (els[i].style.display == 'table-cell')
                els[i].style.display = 'none';
            else
                els[i].style.display = 'table-cell';
        };

        return false;
    }

</script>


